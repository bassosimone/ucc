<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ucc: Optimizer</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>Optimizer</h1>
<p>
<div class="dynheader">
Collaboration diagram for Optimizer:</div>
<div class="dynsection">
<center><table><tr><td><img src="a00031.png" border="0" alt="" usemap="#a00052_map">
<map name="a00052_map">
<area shape="rect" href="a00030.html" title="Optimizer implementation" alt="" coords="139,5,328,32"></map></td></tr></table></center>
</div>
<hr><a name="_details"></a><h2>Detailed Description</h2>
The <b>optimizer</b> is a module that works on <b>compiler</b> output, trying to make the code faster and smaller. 
<p>
It builds two linked lists, one with <b>global offset table</b> entries and one with <b>code</b> lines. The algorithm used to optimize is roughly as follows:<p>
<ul>
<li>
Replace with <code>VM_NOP</code> all redundant instructions; </li>
<li>
Rewrite the code, removing all <code>VM_NOP</code>. </li>
</ul>
<p>
There are two cases of redundant instructions:<p>
<ul>
<li>
A <code>VM_JMP</code> that targets next instruction; </li>
<li>
A <code>VM_JTRUE</code>-<code>VM_JFALSE</code> pair. </li>
</ul>
<p>
The latter, in particular, is rather common, because the compiler translates a comparison instruction in three instructions: one for comparing, one in case of success and one in case of failure. For instance:<p>
<pre>
   1 VM_MAEQ    $1, "The Forest Of October"    # Comparison
   2 VM_JTRUE   4                              # Success
   3 VM_JFALSE  20                             # Failure
 </pre><p>
This is rather inefficient, because there is always an unneeded jump, either in the true or in the false case, depending on the flow of the original program. Therefore, the optimizer will remove such unneded jump, making the code faster and smaller.<p>
It is very important to note that compiler and optimizer agrees that there will always be a <code>VM_JFALSE</code> after a <code>VM_JTRUE</code>. For this reason, the optimizer parser will reject a source file that breaks this rule. An alternative design, e.g. allowing unpaired conditional jumps, is possible, but slower. Infact we'd need to scan the code in search for paired jumps, while with current design we optimize in the semantic rule. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Modules</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00030.html">Optimizer implementation</a></td></tr>

<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00002.html">codeLine</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">A line in the <code>.code</code> section.  <a href="a00002.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00003.html">codeListNode</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Linked list of lines in the <code>.code</code> section.  <a href="a00003.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00004.html">gotLine</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Line in the <code>.got</code> section.  <a href="a00004.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00005.html">gotListNode</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Linked list of lines in the <code>.got</code> section.  <a href="a00005.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Defines</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">#define&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#g2ceb5b985e149f18e018b142cfdd7264">YYSTYPE</a>&nbsp;&nbsp;&nbsp;const char*</td></tr>

<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#g20b979e4b4bd026c10540af3fa061b19">code_line_add</a> (<a class="el" href="a00002.html">codeLine</a> *current)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00031.html#g4d1ad670bab4cda3a7c44ff8d602780a">got_line_add</a> (<a class="el" href="a00004.html">gotLine</a> *current)</td></tr>

</table>
<hr><h2>Define Documentation</h2>
<a class="anchor" name="g2ceb5b985e149f18e018b142cfdd7264"></a><!-- doxytag: member="optimizer.h::YYSTYPE" ref="g2ceb5b985e149f18e018b142cfdd7264" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define YYSTYPE&nbsp;&nbsp;&nbsp;const char*          </td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
This is the type that will be used in parser and scanner. 
<p>

</div>
</div><p>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="g20b979e4b4bd026c10540af3fa061b19"></a><!-- doxytag: member="optimizer.h::code_line_add" ref="g20b979e4b4bd026c10540af3fa061b19" args="(codeLine *current)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void code_line_add           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00002.html">codeLine</a> *&nbsp;</td>
          <td class="paramname"> <em>current</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add data from a code line to the proper linked list. 
<p>

</div>
</div><p>
<a class="anchor" name="g4d1ad670bab4cda3a7c44ff8d602780a"></a><!-- doxytag: member="optimizer.h::got_line_add" ref="g4d1ad670bab4cda3a7c44ff8d602780a" args="(gotLine *current)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void got_line_add           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00004.html">gotLine</a> *&nbsp;</td>
          <td class="paramname"> <em>current</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Add data from a got line to the proper linked list. 
<p>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 11 15:19:42 2008 for ucc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
