<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head><meta http-equiv="Content-Type" content="text/html;charset=UTF-8">
<title>ucc: Memory management</title>
<link href="doxygen.css" rel="stylesheet" type="text/css">
<link href="tabs.css" rel="stylesheet" type="text/css">
</head><body>
<!-- Generated by Doxygen 1.5.3 -->
<div class="tabs">
  <ul>
    <li><a href="index.html"><span>Main&nbsp;Page</span></a></li>
    <li><a href="modules.html"><span>Modules</span></a></li>
    <li><a href="annotated.html"><span>Data&nbsp;Structures</span></a></li>
    <li><a href="files.html"><span>Files</span></a></li>
  </ul>
</div>
<h1>Memory management<br>
<small>
[<a class="el" href="a00023.html">Compiler implementation</a>]</small>
</h1>
<p>
<div class="dynheader">
Collaboration diagram for Memory management:</div>
<div class="dynsection">
<center><table><tr><td><img src="a00024.png" border="0" alt="" usemap="#a00045_map">
<map name="a00045_map">
<area shape="rect" href="a00023.html" title="Compiler implementation" alt="" coords="7,5,191,32"></map></td></tr></table></center>
</div>
<hr><a name="_details"></a><h2>Detailed Description</h2>
Memory allocation strategy. 
<p>
We keep a cache for commonly used objects, which are<p>
<ul>
<li>
headers for registering memory allocations; </li>
<li>
entries in backpatching lists; </li>
<li>
nodes used during parsing. </li>
</ul>
<p>
These cache are never flushed, because the reasonable point where to do it is at the end of the program. Other allocations, such as strings etc, are registered for being freed when the proper storage is cleared. We keep three storages: one for temporary allocations when parsing current function, one for symbol table and one for code. The former is cleared every time a function is successfully parsed; while the others are never cleared because their lifecycle is the same as the program one. 
<p>
<table border="0" cellpadding="0" cellspacing="0">
<tr><td></td></tr>
<tr><td colspan="2"><br><h2>Data Structures</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00008.html">p_storage_header</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Header for allocated block of memory.  <a href="a00008.html#_details">More...</a><br></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">struct &nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00007.html">p_storage</a></td></tr>

<tr><td class="mdescLeft">&nbsp;</td><td class="mdescRight">Memory allocator and garbage collector.  <a href="a00007.html#_details">More...</a><br></td></tr>
<tr><td colspan="2"><br><h2>Functions</h2></td></tr>
<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="a00007.html">p_storage</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#gdb3dabf1a83c71b857d62adfedf68edc">p_storage_create</a> (void)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#g72780ed089a78d5ea215d70ac5756acc">p_storage_clear</a> (<a class="el" href="a00007.html">p_storage</a> *storage)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="a00008.html">p_storage_header</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#g24489c7efecb58fbd517a3934448b7aa">p_storage_header_alloc</a> (<a class="el" href="a00007.html">p_storage</a> *storage)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="a00006.html">p_node</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#g43b2422c5cfd7efb48bdce1538ffe129">p_storage_node_alloc</a> (<a class="el" href="a00007.html">p_storage</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static <a class="el" href="a00001.html">bp_entry</a> *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#g6e21b9ceb3ff2426a8de4cb00301264b">p_storage_entry_alloc</a> (<a class="el" href="a00007.html">p_storage</a> *s)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#g0c69ff9f7c7ea7780a2b19ab8a2ecd06">p_storage_header_register</a> (<a class="el" href="a00007.html">p_storage</a> *s, <a class="el" href="a00008.html">p_storage_header</a> *h)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static void *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#g0efe29f24c1ee2a58caa27c2d37ad045">p_storage_alloc</a> (<a class="el" href="a00007.html">p_storage</a> *storage, size_t size)</td></tr>

<tr><td class="memItemLeft" nowrap align="right" valign="top">static char *&nbsp;</td><td class="memItemRight" valign="bottom"><a class="el" href="a00024.html#gadbfebeab47a468fd35c4bf3a796059a">p_storage_strdup</a> (<a class="el" href="a00007.html">p_storage</a> *storage, const char *str)</td></tr>

</table>
<hr><h2>Function Documentation</h2>
<a class="anchor" name="gdb3dabf1a83c71b857d62adfedf68edc"></a><!-- doxytag: member="compiler/main.c::p_storage_create" ref="gdb3dabf1a83c71b857d62adfedf68edc" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="a00007.html">p_storage</a>* p_storage_create           </td>
          <td>(</td>
          <td class="paramtype">void&nbsp;</td>
          <td class="paramname">          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Create memory allocator. 
<p>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>New memory allocator. </dd></dl>

</div>
</div><p>
<a class="anchor" name="g72780ed089a78d5ea215d70ac5756acc"></a><!-- doxytag: member="compiler/main.c::p_storage_clear" ref="g72780ed089a78d5ea215d70ac5756acc" args="(p_storage *storage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void p_storage_clear           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00007.html">p_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>storage</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Clear the memory used by memory allocator. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>storage</em>&nbsp;</td><td>Memory allocator. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="g24489c7efecb58fbd517a3934448b7aa"></a><!-- doxytag: member="compiler/main.c::p_storage_header_alloc" ref="g24489c7efecb58fbd517a3934448b7aa" args="(p_storage *storage)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="a00008.html">p_storage_header</a>* p_storage_header_alloc           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00007.html">p_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>storage</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Allocate header for allocated block of memory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>storage</em>&nbsp;</td><td>Memory allocator. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Header for allocated block of memory. </dd></dl>

</div>
</div><p>
<a class="anchor" name="g43b2422c5cfd7efb48bdce1538ffe129"></a><!-- doxytag: member="compiler/main.c::p_storage_node_alloc" ref="g43b2422c5cfd7efb48bdce1538ffe129" args="(p_storage *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="a00006.html">p_node</a>* p_storage_node_alloc           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00007.html">p_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Allocate node for parsing tree. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Memory allocator. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Node for parsing tree. </dd></dl>

</div>
</div><p>
<a class="anchor" name="g6e21b9ceb3ff2426a8de4cb00301264b"></a><!-- doxytag: member="compiler/main.c::p_storage_entry_alloc" ref="g6e21b9ceb3ff2426a8de4cb00301264b" args="(p_storage *s)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static <a class="el" href="a00001.html">bp_entry</a>* p_storage_entry_alloc           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00007.html">p_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>          </td>
          <td>&nbsp;)&nbsp;</td>
          <td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Allocate entry for backpatching list. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Memory allocator. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Entry for backpatching list. </dd></dl>

</div>
</div><p>
<a class="anchor" name="g0c69ff9f7c7ea7780a2b19ab8a2ecd06"></a><!-- doxytag: member="compiler/main.c::p_storage_header_register" ref="g0c69ff9f7c7ea7780a2b19ab8a2ecd06" args="(p_storage *s, p_storage_header *h)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void p_storage_header_register           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00007.html">p_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>s</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="a00008.html">p_storage_header</a> *&nbsp;</td>
          <td class="paramname"> <em>h</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Register a storage header with memory allocator. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>s</em>&nbsp;</td><td>Memory allocator. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>h</em>&nbsp;</td><td>Storage header. </td></tr>
  </table>
</dl>

</div>
</div><p>
<a class="anchor" name="g0efe29f24c1ee2a58caa27c2d37ad045"></a><!-- doxytag: member="compiler/main.c::p_storage_alloc" ref="g0efe29f24c1ee2a58caa27c2d37ad045" args="(p_storage *storage, size_t size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void* p_storage_alloc           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00007.html">p_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>storage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&nbsp;</td>
          <td class="paramname"> <em>size</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Allocate a block of memory. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>storage</em>&nbsp;</td><td>Memory allocator. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>size</em>&nbsp;</td><td>Size of memory block. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>Memory block. </dd></dl>

</div>
</div><p>
<a class="anchor" name="gadbfebeab47a468fd35c4bf3a796059a"></a><!-- doxytag: member="compiler/main.c::p_storage_strdup" ref="gadbfebeab47a468fd35c4bf3a796059a" args="(p_storage *storage, const char *str)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static char* p_storage_strdup           </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="a00007.html">p_storage</a> *&nbsp;</td>
          <td class="paramname"> <em>storage</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const char *&nbsp;</td>
          <td class="paramname"> <em>str</em></td><td>&nbsp;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td><td width="100%"><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>
Duplicate a C string. 
<p>
<dl compact><dt><b>Parameters:</b></dt><dd>
  <table border="0" cellspacing="2" cellpadding="0">
    <tr><td valign="top"></td><td valign="top"><em>storage</em>&nbsp;</td><td>Memory allocator. </td></tr>
    <tr><td valign="top"></td><td valign="top"><em>str</em>&nbsp;</td><td>C string to duplicate. </td></tr>
  </table>
</dl>
<dl class="return" compact><dt><b>Returns:</b></dt><dd>C string. </dd></dl>

</div>
</div><p>
<hr size="1"><address style="text-align: right;"><small>Generated on Mon Feb 11 17:23:35 2008 for ucc by&nbsp;
<a href="http://www.doxygen.org/index.html">
<img src="doxygen.png" alt="doxygen" align="middle" border="0"></a> 1.5.3 </small></address>
</body>
</html>
